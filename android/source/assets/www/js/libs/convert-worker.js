/* 1.1.5 2023-04-29 13:37:37 - Incredibox - Designed with love & passion since 2009 */
function convertToMP3(t){for(var e,a,n,s=new lamejs.Mp3Encoder(t.numberC,t.sampleR,t.kbps),r=[],o=getDataAsInt16Array(t.leftData),g=getDataAsInt16Array(t.rightData),i=576,l=Math.floor(t.lng/i/40),p=l,v=0,A=0;v<t.lng;v+=i,A++)p<A&&(p+=l,postMessage({type:"msg",val:"mp3 DATA en cours"})),e=o.subarray(v,v+i),a=g.subarray(v,v+i),0<(n=s.encodeBuffer(e,a)).length&&r.push(n);0<(n=s.flush()).length&&r.push(n),postMessage({type:"data",val:r})}function getDataAsInt16Array(t){for(var e=t,a=e.length,n=0,s=new Int16Array(a);n<a;)s[n]=function(t){t=t<0?32768*t:32767*t;return Math.max(-32768,Math.min(32768,t))}(e[n++]);return s}function convertToWAV(t,e){var a=t.numberC,n=t.sampleR,e=(e=e||{}).float32?3:1,s=3==e?32:16,t=2===a?interleave(t.leftData,t.rightData):t.leftData,t=encodeWAV(t,e,n,a,s);postMessage({type:"data",val:t})}function encodeWAV(t,e,a,n,s){var r=s/8,o=n*r,g=new ArrayBuffer(44+t.length*r),i=new DataView(g);return writeString(i,0,"RIFF"),i.setUint32(4,36+t.length*r,!0),postMessage({type:"msg",val:"wav DATA en cours"}),writeString(i,8,"WAVE"),postMessage({type:"msg",val:"wav DATA en cours"}),writeString(i,12,"fmt "),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(16,16,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(20,e,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(22,n,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(24,a,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(28,a*o,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(32,o,!0),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint16(34,s,!0),writeString(i,36,"data"),postMessage({type:"msg",val:"wav DATA en cours"}),i.setUint32(40,t.length*r,!0),(1===e?floatTo16BitPCM:writeFloat32)(i,44,t),g}function interleave(t,e){for(var a=t.length+e.length,n=new Float32Array(a),s=0,r=0;s<a;)n[s++]=t[r],n[s++]=e[r],r++;return n}function writeFloat32(t,e,a){for(var n=0;n<a.length;n++,e+=4)t.setFloat32(e,a[n],!0)}function floatTo16BitPCM(t,e,a){for(var n=0;n<a.length;n++,e+=2){var s=Math.max(-1,Math.min(1,a[n]));t.setInt16(e,s<0?32768*s:32767*s,!0)}}function writeString(t,e,a){for(var n=0;n<a.length;n++)t.setUint8(e+n,a.charCodeAt(n))}"undefined"==typeof window&&importScripts("./lame.min.js"),onmessage=function(t){t=t.data[0];("mp3"==t.typeToExport?convertToMP3:convertToWAV)(t)};